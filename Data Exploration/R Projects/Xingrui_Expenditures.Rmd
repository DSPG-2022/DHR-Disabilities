---
title: "Xingrui_Expenditures"
author: "Xingrui Xue"
output: html_document
---

```{r}
library(tidyverse)
library(openxlsx)
library(stringr)
```

```{r}
budgeted <- read.csv("County_Budgeted_Expenditures_By_Service_Area_By_Fiscal_Year.csv")
actual <- read.csv("County_Actual_Expenditures_by_Service_Area_by_Fiscal_Year.csv")
```

Gap Between Budgeted and Actual Expenditures for Physical Health & Social Services (2010-2021)
```{r}
PhysicalBudgeted <- budgeted %>%
  select(c(2, 4, 6)) %>%
  filter(Fiscal.Year.Ending %in% c(2010:2021)) %>%
  arrange(Fiscal.Year.Ending, County.Name)

PhysicalActual <- actual %>%
  select(c(1, 3, 5)) %>%
  filter(FISCAL.YEAR %in% c(2010:2021)) %>%
  arrange(FISCAL.YEAR, County)

PhysicalGap <- cbind(PhysicalActual, PhysicalBudgeted) %>%
  select(-c(4, 5)) %>%
  mutate(County = toupper(County),
         "Gap (Actual-Budgeted)" = PHYSICAL.HEALTH.SOCIAL.SERVICES - Physical.Health...Social.Services) %>%
  select(-c(Physical.Health...Social.Services, PHYSICAL.HEALTH.SOCIAL.SERVICES)) %>%
  pivot_wider(names_from = FISCAL.YEAR,
              values_from = "Gap (Actual-Budgeted)")

write.xlsx(PhysicalGap, "PhysicalGap.xlsx")
```

Gap Between Budgeted and Actual Expenditures for MENTAL HEALTH, ID & DD (2010-2021)
```{r}
MentalBudgeted <- budgeted %>%
  select(c(2, 4, 7)) %>%
  filter(Fiscal.Year.Ending %in% c(2010:2021)) %>%
  arrange(Fiscal.Year.Ending, County.Name)

MentalActual <- actual %>%
  select(c(1, 3, 6)) %>%
  filter(FISCAL.YEAR %in% c(2010:2021)) %>%
  arrange(FISCAL.YEAR, County)

MentalGap <- cbind(MentalActual, MentalBudgeted) %>%
  select(-c(4, 5)) %>%
  mutate(County = toupper(County),
         "Gap (Actual-Budgeted)" = MENTAL.HEALTH..ID...DD - Mental.Health.MR..DD) %>%
  select(-c(MENTAL.HEALTH..ID...DD, Mental.Health.MR..DD)) %>%
  pivot_wider(names_from = FISCAL.YEAR,
              values_from = "Gap (Actual-Budgeted)")

write.xlsx(MentalGap, "MentalGap.xlsx")
```
Gap Between Budgeted and Actual Expenditures for Physical Health & Social Services and MENTAL HEALTH, ID & DD (2010-2021)
```{r}
PhysicalGap1 <- cbind(PhysicalActual, PhysicalBudgeted) %>%
  select(-c(4, 5)) %>%
  mutate(County = toupper(County),
         "Physical Gap (Actual-Budgeted)" = PHYSICAL.HEALTH.SOCIAL.SERVICES - Physical.Health...Social.Services) %>%
  select(-c(Physical.Health...Social.Services, PHYSICAL.HEALTH.SOCIAL.SERVICES))
  
MentalGap1 <- cbind(MentalActual, MentalBudgeted) %>%
  select(-c(4, 5)) %>%
  mutate(County = toupper(County),
         "Mental Gap (Actual-Budgeted)" = MENTAL.HEALTH..ID...DD - Mental.Health.MR..DD) %>%
  select(-c(MENTAL.HEALTH..ID...DD, Mental.Health.MR..DD))

ExpenditureGap <- cbind(PhysicalGap1, MentalGap1) %>%
  select(-c(4, 5))

write.xlsx(ExpenditureGap, "Expenditures Gap.xlsx")
```

Mean Gap Between Budgeted and Actual Expenditures for Physical Health & Social Services and MENTAL HEALTH, ID & DD (2010-2021)
```{r}
# ExpenditureGap1 <- ExpenditureGap %>% filter(FISCAL.YEAR %in% c(2016:2020))

PhysicalGapMean <- aggregate(`Physical Gap (Actual-Budgeted)` ~ County, data = ExpenditureGap, mean)
MentalGapMean <- aggregate(`Mental Gap (Actual-Budgeted)` ~ County, data = ExpenditureGap, mean)

GapMean <- full_join(PhysicalGapMean, MentalGapMean, by = "County")

write.xlsx(GapMean, "Mean Expenditures Gap.xlsx")
```
Mean Gap and median earnings
```{r}
earnings <- read.xlsx("Median Earnings.xlsx")

MeanGap_MieianEarnings <- cbind(GapMean, earnings) %>%
  select(-c(4:6))

write.xlsx(MeanGap_MieianEarnings, "MeanGap_MieianEarnings.xlsx")
```

Actual mean expenditures and disabled population for Physical Health & Social Services and MENTAL HEALTH, ID & DD (2016-2020)
```{r}
DisabledPop <- read.xlsx("DisabledPop.xlsx", sheet = 1)

PhysicalActual1 <- actual %>%
  select(c(1, 3, 5)) %>%
  filter(FISCAL.YEAR %in% c(2016:2020)) %>%
  mutate(County = toupper(County)) %>%
  arrange(FISCAL.YEAR, County)

PhysicalActual1 <- aggregate(PHYSICAL.HEALTH.SOCIAL.SERVICES ~ County, data = PhysicalActual1, mean)

MentalActual1 <- actual %>%
  select(c(1, 3, 6)) %>%
  filter(FISCAL.YEAR %in% c(2016:2020)) %>%
  mutate(County = toupper(County)) %>%
  arrange(FISCAL.YEAR, County)

MentalActual1 <- aggregate(MENTAL.HEALTH..ID...DD ~ County, data = MentalActual1, mean)

DisabledPop <- DisabledPop %>% select(1, 5, 6)

ActualExpenditures_DisabledPop <- cbind(DisabledPop, PhysicalActual1, MentalActual1) %>%
  select(-c(4, 6))

write.xlsx(ActualExpenditures_DisabledPop, "ActualExpenditures_DisabledPop.xlsx")

view(ActualExpenditures_DisabledPop)
```