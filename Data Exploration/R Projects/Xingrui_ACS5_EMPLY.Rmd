---
title: "Xingrui_ACS5_EMPLY"
author: "Xingrui Xue"
output: html_document
---

```{r}
library(tidycensus)
library(tidyverse)
library(openxlsx)
library(stringr)

acs5 <- load_variables(2020, "acs5")
```

1.1 Population of Iowans 18-64 years with disabilities and without disabilities by age
```{r}
Aged18to34 <- c(Total = c("B18101_009", "B18101_028"), Disabled = c("B18101_010", "B18101_029"), Nondisabled = c("B18101_011", "B18101_030"))
Aged35to64 <- c(Total = c("B18101_012", "B18101_031"), Disabled = c("B18101_013", "B18101_032"), Nondisabled = c("B18101_014", "B18101_033"))

population <- get_acs(geography = "county",
                      variables = c("18 to 34 years" = Aged18to34, "35 to 64 years" = Aged35to64),
                      year = 2020,
                      state = "IA")

population$variable <- str_sub(population$variable, end = -2)

population <- population %>%
  group_by(NAME, variable) %>%
  summarise(estimate = sum(estimate),
            moe = sum(moe)) %>%
  pivot_wider(names_from = variable,
              values_from = c(estimate, moe))

names(population) <- gsub("estimate_", "", names(population))
population$NAME <- gsub(" County, Iowa", "", population$NAME)
names(population)[names(population) == "NAME"] <- "County"
```

1.2 Testing the reliability of population data
```{r}
CV_18_to_34_Disabled <- ((population$`moe_18 to 34 years.Disabled` / 1.645) / population$`18 to 34 years.Disabled`) * 100
CV_18_to_34_Nondisabled <- ((population$`moe_18 to 34 years.Nondisabled` / 1.645) / population$`18 to 34 years.Nondisabled`) * 100
CV_35_to_64_Disabled <- ((population$`moe_35 to 64 years.Disabled` / 1.645) / population$`35 to 64 years.Disabled`) * 100
CV_35_to_64_Nondisabled <- ((population$`moe_35 to 64 years.Nondisabled` / 1.645) / population$`35 to 64 years.Nondisabled`) * 100

population$CV_18_to_34_Disabled <- ifelse(CV_18_to_34_Disabled > 30, "Low reliability",
                                          ifelse(CV_18_to_34_Disabled <= 15, "High reliability",
                                                 "Median reliability"))
population$CV_18_to_34_Nondisabled <- ifelse(CV_18_to_34_Nondisabled > 30, "Low reliability",
                                          ifelse(CV_18_to_34_Nondisabled <= 15, "High reliability",
                                                 "Median reliability"))
population$CV_35_to_64_Disabled <- ifelse(CV_35_to_64_Disabled > 30, "Low reliability",
                                          ifelse(CV_35_to_64_Disabled <= 15, "High reliability",
                                                 "Median reliability"))
population$CV_35_to_64_Nondisabled <- ifelse(CV_35_to_64_Nondisabled > 30, "Low reliability",
                                          ifelse(CV_35_to_64_Nondisabled <= 15, "High reliability",
                                                 "Median reliability"))
```

1.3 Total population with disabilities from SEX BY AGE BY DISABILITY STATUS
```{r}
pop <- get_acs(geography = "county",
               variables = c("B18101_004", "B18101_007", "B18101_010", "B18101_013", "B18101_016", "B18101_019",
                             "B18101_023", "B18101_026", "B18101_029", "B18101_032", "B18101_035", "B18101_038"),
               state = "IA")

pop1 <- aggregate(estimate ~ NAME, data = pop, sum)
pop2 <- aggregate(moe ~ NAME, data = pop, sum)

pop <- full_join(pop1, pop2)

pop$NAME <- gsub(" County, Iowa", "", pop$NAME)
names(pop)[names(pop) == "NAME"] <- "County"
names(pop)[names(pop) == "estimate"] <- "Total disabled population of all ages"
```

1.4 Testing the reliability of pop data
```{r}
CV_TotalDisabledOfAllAge <- ((pop$moe / 1.645) / pop$`Total disabled population of all ages`) * 100

pop$CV_TotalDisabledOfAllAge <- ifelse(CV_TotalDisabledOfAllAge > 30, "Low reliability",
                                       ifelse(CV_TotalDisabledOfAllAge <= 15, "High reliability",
                                              "Median reliability"))

population <- full_join(population, pop)

# View(population)
# write.xlsx(population, "Population.xlsx")
```
1.5 total with a disability / total population = percent of total population with a disability 
```{r}
Total <- c(Total = "B18101_001")
DisabledMale <- c("Under 5 years" = "B18101_004", "5 to 17 years" = "B18101_007", "18 to 34 years" = "B18101_010", "35 to 64 years" = "B18101_013", "65 to 74 years" = "B18101_016", "75 years and over" = "B18101_019")
DisabledFemale <- c("Under 5 years" = "B18101_023", "5 to 17 years" = "B18101_026", "18 to 34 years" = "B18101_029", "35 to 64 years" = "B18101_032", "65 to 74 years" = "B18101_035", "75 years and over" = "B18101_035")

DisabledPop <- get_acs(geography = "county",
                       variables = c(Total, DisabledMale, DisabledFemale),
                       year = 2020,
                       state = "IA")

DisabledPop <- DisabledPop %>%
  group_by(NAME, variable) %>%
  summarise(estimate = sum(estimate),
            moe = sum(moe)) %>%
  pivot_wider(names_from = variable, values_from = c(estimate, moe))

DisabledPop$NAME <- gsub(" County, Iowa", "", DisabledPop$NAME)
names(DisabledPop)[names(DisabledPop) == "NAME"] <- "County"

# write.xlsx(DisabledPop, "DisabledPop.xlsx")
```

1.6 16-64 with a disability / total with a disability = percent of disabled population in the working age group
```{r}

```

2.1 Population of Iowans 18-64 years with disabilities by age groups
```{r}
DisabledHearing <- c("18 to 34 years" = c("B18102_010", "B18102_029"), "35 to 64 years" = c("B18102_013", "B18102_032"))
DisabledVision <- c("18 to 34 years" = c("B18103_010", "B18103_029"), "35 to 64 years" = c("B18103_007", "B18103_032"))
DisabledCognitive <- c("18 to 34 years" = c("B18104_007", "B18104_023"), "35 to 64 years" = c("B18104_010", "B18104_026"))
DisabledAmbulatory <- c("18 to 34 years" = c("B18105_007", "B18105_023"), "35 to 64 years" = c("B18105_010", "B18105_026"))
DisabledSelfCare <- c("18 to 34 years" = c("B18106_007", "B18106_023"), "35 to 64 years" = c("B18106_010", "B18106_026"))
DisabledIndependentLiving <- c("18 to 34 years" = c("B18107_007", "B18107_023"), "35 to 64 years" = c("B18107_010", "B18107_026"))

DisabledType <- get_acs(geography = "county",
                        variables = c(Hearing = DisabledHearing, Vision = DisabledVision, Cognitive = DisabledCognitive, Ambulatory = DisabledAmbulatory, "Self-care" = DisabledSelfCare, "Independent living" = DisabledIndependentLiving),
                        year = 2020,
                        state = "IA")

DisabledType$variable <- gsub("(years).*", "\\1", DisabledType$variable)

DisabledType <- DisabledType %>%
  group_by(NAME, variable) %>%
  summarise(estimate = sum(estimate),
            moe = sum(moe))

DisabledType_pivot <- DisabledType %>% separate(variable, into = c("Type", "Age"), sep = "\\.") %>%
  pivot_wider(names_from = Type, values_from = c(estimate, moe))

DisabledType_sum <- aggregate(estimate ~ NAME, data = DisabledType, sum) %>%
  slice(rep(1:n(), each = 2))

DisabledType_pivot <- DisabledType_pivot %>%
  ungroup() %>%
  mutate(Percentage = rowSums(DisabledType_pivot[3:8] / DisabledType_sum$estimate) * 100)

names(DisabledType_pivot) <- gsub("estimate_", "", names(DisabledType_pivot))
DisabledType_pivot$NAME <- gsub(" County, Iowa", "", DisabledType_pivot$NAME)
names(DisabledType_pivot)[names(DisabledType_pivot) == "NAME"] <- "County"
```

2.2 Testing the reliability of DisabledType_pivot data
```{r}
CV_Cognitive <- ((DisabledType_pivot$moe_Cognitive / 1.645) / DisabledType_pivot$Cognitive) * 100
CV_Hearing <- ((DisabledType_pivot$moe_Hearing / 1.645) / DisabledType_pivot$Hearing) * 100
CV_IndependentLiving  <- ((DisabledType_pivot$`moe_Independent living` / 1.645) / DisabledType_pivot$`Independent living`) * 100
CV_Selfcare <- ((DisabledType_pivot$`moe_Self-care` / 1.645) / DisabledType_pivot$`Self-care`) * 100
CV_Vision <- ((DisabledType_pivot$moe_Vision / 1.645) / DisabledType_pivot$Vision) * 100
CV_Ambulatory <- ((DisabledType_pivot$moe_Ambulatory / 1.645) / DisabledType_pivot$Ambulatory) * 100

DisabledType_pivot$CV_Cognitive <- ifelse(CV_Cognitive > 30, "Low reliability",
                                          ifelse(CV_Cognitive <= 15, "High reliability",
                                                 "Median reliability"))
DisabledType_pivot$CV_Hearing <- ifelse(CV_Hearing > 30, "Low reliability",
                                        ifelse(CV_Hearing <= 15, "High reliability",
                                               "Median reliability"))
DisabledType_pivot$CV_IndependentLiving <- ifelse(CV_IndependentLiving > 30, "Low reliability",
                                                  ifelse(CV_IndependentLiving <= 15, "High reliability",
                                                         "Median reliability"))
DisabledType_pivot$CV_Selfcare <- ifelse(CV_Selfcare > 30, "Low reliability",
                                         ifelse(CV_Selfcare <= 15, "High reliability",
                                                "Median reliability"))
DisabledType_pivot$CV_Vision <- ifelse(CV_Vision > 30, "Low reliability",
                                       ifelse(CV_Vision <= 15, "High reliability",
                                              "Median reliability"))
DisabledType_pivot$CV_Ambulatory <- ifelse(CV_Ambulatory > 30, "Low reliability",
                                       ifelse(CV_Ambulatory <= 15, "High reliability",
                                              "Median reliability"))

# View(DisabledType_pivot)
# write.xlsx(DisabledType_pivot, "DisabledType1.xlsx")
```

3.1 Population of Iowans 18-64 years of age with disabilities by difficulty types
```{r}
DisabledType_pivot1 <- DisabledType %>% separate(variable, into = c("Type", "Age"), sep = "\\.") %>%
  pivot_wider(names_from = Age, values_from = c(estimate, moe))

DisabledType_sum1 <- aggregate(estimate ~ NAME, data = DisabledType, sum) %>%
  slice(rep(1:n(), each = 6))

DisabledType_pivot1 <- DisabledType_pivot1 %>%
  ungroup() %>%
  mutate(Percent = rowSums(DisabledType_pivot1[3:4] / DisabledType_sum1$estimate) * 100)

names(DisabledType_pivot1) <- gsub("estimate_", "", names(DisabledType_pivot1))
DisabledType_pivot1$NAME <- gsub(" County, Iowa", "", DisabledType_pivot1$NAME)
names(DisabledType_pivot1)[names(DisabledType_pivot1) == "NAME"] <- "County"
```

3.2 Testing the reliability of DisabledType_pivot1 data
```{r}
CV_Disabled18to34 <- ((DisabledType_pivot1$`moe_18 to 34 years` / 1.645) / DisabledType_pivot1$`18 to 34 years` ) * 100
CV_Disabled35to64 <- ((DisabledType_pivot1$`moe_35 to 64 years` / 1.645) / DisabledType_pivot1$`35 to 64 years` ) * 100

DisabledType_pivot1$CV_Disabled_18to34 <- ifelse(CV_Disabled18to34 > 30, "Low reliability",
                                                 ifelse(CV_Disabled18to34 <= 15, "High reliability",
                                                        "Median reliability"))
DisabledType_pivot1$CV_Disabled_35to64 <- ifelse(CV_Disabled35to64 > 30, "Low reliability",
                                                 ifelse(CV_Disabled35to64 <= 15, "High reliability",
                                                        "Median reliability"))

# view(DisabledType_pivot1)
# write.xlsx(DisabledType_pivot1, "DisabledType2.xlsx")
```

3.3 Proportion of each type of difficulty among persons with disabilities aged 18-64
```{r}
DisabledType2 <- read.xlsx("DisabledType2 18-64 years.xlsx", sheet = 2)

DisabledType2 <- pivot_wider(DisabledType2,
                             names_from = Type,
                             values_from = c("18.to.64.years", "moe_18.to.64.years"))

DisabledType_sum2 <- aggregate(estimate ~ NAME, data = DisabledType, sum)

DisabledType2$Ambulatory.Pct <- DisabledType2$`18.to.64.years_Ambulatory` / DisabledType_sum2$estimate * 100
DisabledType2$Cognitive.Pct <- DisabledType2$`18.to.64.years_Cognitive`  / DisabledType_sum2$estimate * 100
DisabledType2$Hearing.Pct <- DisabledType2$`18.to.64.years_Hearing` / DisabledType_sum2$estimate * 100
DisabledType2$IndependentLiving.Pct <- DisabledType2$`18.to.64.years_Independent living` / DisabledType_sum2$estimate * 100
DisabledType2$SelfCare.Pct <- DisabledType2$`18.to.64.years_Self-care` / DisabledType_sum2$estimate * 100
DisabledType2$Vision.Pct <- DisabledType2$`18.to.64.years_Vision` / DisabledType_sum2$estimate * 100
```

3.4 Testing the reliability of DisabledType2 data
```{r}
CV_ambulatory <- ((DisabledType2$moe_18.to.64.years_Ambulatory / 1.645) / DisabledType2$`18.to.64.years_Ambulatory`) * 100
CV_cognitive <- ((DisabledType2$moe_18.to.64.years_Cognitive / 1.645) / DisabledType2$`18.to.64.years_Cognitive`) * 100
CV_hearing <- ((DisabledType2$moe_18.to.64.years_Hearing / 1.645) / DisabledType2$`18.to.64.years_Hearing`) * 100
CV_independent_living <- ((DisabledType2$`moe_18.to.64.years_Independent living` / 1.645) / DisabledType2$`18.to.64.years_Independent living`) * 100
CV_selfcare <- ((DisabledType2$`moe_18.to.64.years_Self-care` / 1.645) / DisabledType2$`18.to.64.years_Self-care`) * 100
CV_vision <- ((DisabledType2$moe_18.to.64.years_Vision / 1.645) / DisabledType2$`18.to.64.years_Vision`) * 100

DisabledType2$CV_ambulatory <- ifelse(CV_ambulatory > 30, "Low reliability",
                                      ifelse(CV_ambulatory <= 15, "High reliability",
                                             "Median reliability"))
DisabledType2$CV_cognitive <- ifelse(CV_cognitive > 30, "Low reliability",
                                     ifelse(CV_cognitive <= 15, "High reliability",
                                            "Median reliability"))
DisabledType2$CV_hearing <- ifelse(CV_hearing > 30, "Low reliability",
                                   ifelse(CV_hearing <= 15, "High reliability",
                                          "Median reliability"))
DisabledType2$CV_independent_living <- ifelse(CV_independent_living > 30, "Low reliability",
                                              ifelse(CV_independent_living <= 15, "High reliability",
                                                     "Median reliability"))
DisabledType2$CV_selfcare <- ifelse(CV_selfcare > 30, "Low reliability",
                                    ifelse(CV_selfcare <= 15, "High reliability",
                                           "Median reliability"))
DisabledType2$CV_vision <- ifelse(CV_vision > 30, "Low reliability",
                                  ifelse(CV_vision <= 15, "High reliability",
                                         "Median reliability"))

# view(DisabledType2)
# write.xlsx(DisabledType2, "DisabledType.xlsx")
```

3.5 DisabledType2 with Urban/Rural Codes
```{r}
Type <- read.xlsx("DisabledType2 18-64 years.xlsx", sheet = 1)
Divisioin <- read.csv("lookup_county_regions.csv")

TypeDivisioin <- left_join(Type, Divisioin)

write.xlsx(TypeDivisioin, "DisabledType2 with Divisioin.xlsx")
```

4.1 Population of Iowans 18-64 years with disabilities and without disabilities by race and ethnic
```{r}
White <- c("Total White"= "B18101A_005", "Disabled White" = "B18101A_006", "Nondisabled White" = "B18101A_007")
Black <- c("Total Black" ="B18101B_005", "Disabled Black" = "B18101B_006", "Nondisabled Black" = "B18101B_007")
IndianAlaska <- c("Total American Indian and Alaska Native" = "B18101C_005", "Disabled American Indian and Alaska Native" = "B18101C_006", "Nondisabled American Indian and Alaska Native" = "B18101C_007")
Asian <- c("Total Asian" = "B18101D_005", "Disabled Asian" = "B18101D_006", "Nondisabled Asian" = "B18101D_007")
HawaiianPacific <- c("Total Native Hawaiian and Other Pacific Islander" = "B18101E_005", "Disabled Native Hawaiian and Other Pacific Islander" = "B18101E_006", "Nondisabled Native Hawaiian and Other Pacific Islander" = "B18101E_007")
OtherAlone <- c("Total Some Other Race Alone" = "B18101F_005", "Disabled Some Other Race Alone" = "B18101F_006", "Nondisabled Some Other Race Alone" = "B18101F_007")
TwoMore <- c("Total Two Or More Races" = "B18101G_005", "Disabled Two Or More Races" = "B18101G_006", "Nondisabled Two Or More Races" = "B18101G_007")
WhiteAlone <- c("Total White Alone" = "B18101H_005", "Disabled White Alone" = "B18101H_006", "Nondisabled White Alone" = "B18101H_007")
HispanicLatino <- c("Total Hispanic Or Latino" = "B18101I_005", "Disabled Hispanic Or Latino" = "B18101I_006", "Nondisabled Hispanic Or Latino" = "B18101I_007")

RaceEthnic_State <- get_acs(geography = "state",
                             variables = c(White, Black, IndianAlaska, Asian, HawaiianPacific, OtherAlone, TwoMore, WhiteAlone, HispanicLatino),
                             year = 2020,
                             state = "IA")
RaceEthnic_County <- get_acs(geography = "county",
                             variables = c(White, Black, IndianAlaska, Asian, HawaiianPacific, OtherAlone, TwoMore, WhiteAlone, HispanicLatino),
                             year = 2020,
                             state = "IA")

RaceEthnic <- rbind(RaceEthnic_State, RaceEthnic_County)

RaceEthnic <- RaceEthnic %>%
  pivot_wider(names_from = variable,
              values_from = c(estimate, moe))

names(RaceEthnic) <- gsub("estimate_", "", names(RaceEthnic))
RaceEthnic$NAME <- gsub(" County, Iowa", "", RaceEthnic$NAME)
names(RaceEthnic)[names(RaceEthnic) == "NAME"] <- "County"
```

4.2 Testing the reliability of RaceEthnic data
```{r}
CV_White_Disabled <- ((RaceEthnic$`moe_Disabled White` / 1.645) / RaceEthnic$`Disabled White`) * 100
CV_White_Nondisabled <- ((RaceEthnic$`moe_Nondisabled White` / 1.645) / RaceEthnic$`Nondisabled White`) * 100
CV_Black_Disabled <- ((RaceEthnic$`moe_Disabled Black` / 1.645) / RaceEthnic$`Disabled Black`) * 100
CV_Black_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Black` / 1.645) / RaceEthnic$`Nondisabled Black`) * 100
CV_IndianAlaska_Disabled <- ((RaceEthnic$`moe_Disabled American Indian and Alaska Native` / 1.645) / RaceEthnic$`Disabled American Indian and Alaska Native`) * 100
CV_IndianAlaska_Nondisabled <- ((RaceEthnic$`moe_Nondisabled American Indian and Alaska Native` / 1.645) / RaceEthnic$`Nondisabled American Indian and Alaska Native`) * 100
CV_Asian_Disabled <- ((RaceEthnic$`moe_Disabled Asian` / 1.645) / RaceEthnic$`Disabled Asian`) * 100
CV_Asian_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Asian` / 1.645) / RaceEthnic$`Nondisabled Asian`) * 100
CV_HawaiianPacific_Disabled <- ((RaceEthnic$`moe_Disabled Native Hawaiian and Other Pacific Islander` / 1.645) / RaceEthnic$`Disabled Native Hawaiian and Other Pacific Islander`) * 100
CV_HawaiianPacific_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Native Hawaiian and Other Pacific Islander` / 1.645) / RaceEthnic$`Disabled Native Hawaiian and Other Pacific Islander`) * 100
CV_OtherAlone_Disabled <- ((RaceEthnic$`moe_Disabled Some Other Race Alone` / 1.645) / RaceEthnic$`Disabled Some Other Race Alone`) * 100
CV_OtherAlone_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Some Other Race Alone` / 1.645) / RaceEthnic$`Nondisabled Some Other Race Alone`) * 100
CV_TwoMore_Disabled <- ((RaceEthnic$`moe_Disabled Two Or More Races` / 1.645) / RaceEthnic$`Disabled Two Or More Races`) * 100
CV_TwoMore_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Two Or More Races` / 1.645) / RaceEthnic$`Nondisabled Two Or More Races`) * 100
CV_WhiteAlone_Disabled <- ((RaceEthnic$`moe_Disabled White Alone` / 1.645) / RaceEthnic$`Disabled White Alone`) * 100
CV_WhiteAlone_Nondisabled <- ((RaceEthnic$`moe_Nondisabled White Alone` / 1.645) / RaceEthnic$`Nondisabled White Alone`) * 100
CV_HispanicLatino_Disabled <- ((RaceEthnic$`moe_Disabled Hispanic Or Latino` / 1.645) / RaceEthnic$`Disabled Hispanic Or Latino`) * 100
CV_HispanicLatino_Nondisabled <- ((RaceEthnic$`moe_Nondisabled Hispanic Or Latino` / 1.645) / RaceEthnic$`Nondisabled Hispanic Or Latino`) * 100

RaceEthnic$CV_White_Disabled <- ifelse(CV_White_Disabled > 30, "Low reliability",
                                       ifelse(CV_White_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_White_Nondisabled <- ifelse(CV_White_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_White_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_Black_Disabled <- ifelse(CV_Black_Disabled > 30, "Low reliability",
                                       ifelse(CV_Black_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_Black_Nondisabled <- ifelse(CV_Black_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_Black_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_IndianAlaska_Disabled <- ifelse(CV_IndianAlaska_Disabled > 30, "Low reliability",
                                       ifelse(CV_IndianAlaska_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_IndianAlaska_Nondisabled <- ifelse(CV_IndianAlaska_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_IndianAlaska_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_Asian_Disabled <- ifelse(CV_Asian_Disabled > 30, "Low reliability",
                                       ifelse(CV_Asian_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_Asian_Nondisabled <- ifelse(CV_Asian_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_Asian_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_HawaiianPacific_Disabled <- ifelse(CV_HawaiianPacific_Disabled > 30, "Low reliability",
                                       ifelse(CV_HawaiianPacific_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_HawaiianPacific_Nondisabled <- ifelse(CV_HawaiianPacific_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_HawaiianPacific_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_OtherAlone_Disabled <- ifelse(CV_OtherAlone_Disabled > 30, "Low reliability",
                                       ifelse(CV_OtherAlone_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_OtherAlone_Nondisabled <- ifelse(CV_OtherAlone_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_OtherAlone_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_TwoMore_Disabled <- ifelse(CV_TwoMore_Disabled > 30, "Low reliability",
                                       ifelse(CV_TwoMore_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_TwoMore_Nondisabled <- ifelse(CV_TwoMore_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_White_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_WhiteAlone_Disabled <- ifelse(CV_WhiteAlone_Disabled > 30, "Low reliability",
                                       ifelse(CV_WhiteAlone_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_WhiteAlone_Nondisabled <- ifelse(CV_WhiteAlone_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_WhiteAlone_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_HispanicLatino_Disabled <- ifelse(CV_HispanicLatino_Disabled > 30, "Low reliability",
                                       ifelse(CV_HispanicLatino_Disabled <= 15, "High reliability",
                                              "Median reliability"))
RaceEthnic$CV_HispanicLatino_Nondisabled <- ifelse(CV_HispanicLatino_Nondisabled > 30, "Low reliability",
                                       ifelse(CV_HispanicLatino_Nondisabled <= 15, "High reliability",
                                              "Median reliability"))

# view(RaceEthnic)
# write.xlsx(RaceEthnic, "RaceEthnic.xlsx")
```

5.1 Median earnings of people with a disability
```{r}
earning <- get_acs(geography = "county",
                   variables = "B18140_002",
                   year = 2020,
                   state = "IA")

names(earning) <- gsub("estimate_", "", names(earning))
earning$NAME <- gsub(" County, Iowa", "", earning$NAME)
names(earning)[names(earning) == "NAME"] <- "County"
```

5.2 Testing the reliability of earning data
```{r}
CV_earning <- ((earning$moe / 1.645) / earning$estimate) * 100

earning$CV <- ifelse(CV_earning > 30, "Low reliability",
                     ifelse(CV_earning <= 15, "High reliability",
                            "Median reliability"))

# view(earning)
# write.xlsx(earning, "Median Earnings.xlsx")
```

6.1 Estimate!!Total:!!In the labor force:!!Employed:!!With a disability
```{r}
employment <- get_acs(geography = "county",
                      variables = "C18120_004",
                      year = 2020,
                      state = "IA")

names(employment) <- gsub("estimate_", "", names(employment))
employment$NAME <- gsub(" County, Iowa", "", employment$NAME)
names(employment)[names(employment) == "NAME"] <- "County"
```
6.2 Testing the reliability of employment data
```{r}
CV_employment <- ((employment$moe / 1.645) / employment$estimate) * 100

employment$CV <- ifelse(CV_employment > 30, "Low reliability",
                                       ifelse(CV_employment <= 15, "High reliability",
                                              "Median reliability"))

# write.xlsx(employment, "Employed.xlsx")
```

7.1 Reformatting, MOE, and reliability testing of BRFSS MENTHLTH data
```{r}
MENTHLTH <- read.xlsx("BRFSS For how many days during the past 30 days was your mental health not good.xlsx", sheet = "MENTHLTH")

MENTHLTH$Row.Percent <- as.numeric(MENTHLTH$Row.Percent)
MENTHLTH$`95%.Confidence.Limits.for.Row.Percent.Lower` <- as.numeric(MENTHLTH$`95%.Confidence.Limits.for.Row.Percent.Lower`)
MENTHLTH$`95%.Confidence.Limits.for.Row.Percent.Upper` <- as.numeric(MENTHLTH$`95%.Confidence.Limits.for.Row.Percent.Upper`)

MENTHLTH <- MENTHLTH %>%
  mutate(MOE = `95%.Confidence.Limits.for.Row.Percent.Upper` - Row.Percent)

CV_Row.Percent <- ((MENTHLTH$MOE / 1.645) / MENTHLTH$Row.Percent) * 100

MENTHLTH$CV_Row.Percent <- ifelse(CV_Row.Percent > 30, "Low reliability",
                                  ifelse(CV_Row.Percent <= 15, "High reliability",
                                         "Median reliability"))


# MENTHLTH <- MENTHLTH %>% select(Geography, MENTHLTH, Row.Percent) %>%
#   pivot_wider(names_from = MENTHLTH, values_from = Row.Percent)
# 
# MENTHLTH$None <- as.numeric(MENTHLTH$None)
# MENTHLTH$`14 - 30 days` <- as.numeric(MENTHLTH$`14 - 30 days`)
# MENTHLTH$`< 14 days` <- as.numeric(MENTHLTH$`< 14 days`)

# write.xlsx(MENTHLTH, "BRFSS MENTHLTH.xlsx")
```

7.2 MOE and reliability testing of BRFSS Disable data
```{r}
Disable <- read.xlsx("BRFSS Do you have a disability.xlsx", sheet = "Disable")

Disable <- Disable %>% mutate(MOE = `95%.Confidence.Limits.for.Row.Percent.Upper` - Row.Percent)
Disable <- Disable %>% mutate("Lower MOE" = `95%.Confidence.Limits.for.Row.Percent.Lower` - Row.Percent)
Disable <- Disable %>% mutate("Upper MOE" = `95%.Confidence.Limits.for.Row.Percent.Upper` - Row.Percent)

CV_Row.Percent <- ((Disable$MOE / 1.645) / Disable$Row.Percent) * 100

Disable$CV_Row.Percent <- ifelse(CV_Row.Percent > 30, "Low reliability",
                                 ifelse(CV_Row.Percent <= 15, "High reliability",
                                        "Median reliability"))

# write.xlsx(Disable, "BRFSS Disable.xlsx")
```

8.1 IVRS hourly wage information and ACS median earnings
```{r}
wage <- read.csv("IVRS_Hourly_Wage.csv")
earnings <- read.xlsx("Median Earnings.xlsx")

WageClosure <- wage %>% filter(Client.State == "IA") %>%
  group_by(Client.County) %>%
  summarise("Median Wage Closure" = median(Hourly.Wage..Closure., na.rm = TRUE))

WageEarnings <- left_join(WageClosure, earnings, by = c("Client.County" = "County"))

# write.xlsx(WageEarnings, "IVRS Median Closure Wage and ACS Median Earnings.xlsx")
```